# Пять друзей — Telegram‑бот

Слоган: **«Пять AI-друзей с разными характерами: эмоционально поддержат, посмотрят на ситуацию с разных сторон и помогут найти опору, когда тяжело и не с кем поговорить».**

## Что это
Личный чат в Telegram, где пользователь «зовёт» одного друга или «всех». Никаких «режимов» в пользовательском тексте — только друзья, разговор и поддержка.

## Требования
- Node.js 20
- Telegram Bot Token
- OpenAI API Key

## Переменные окружения
- `BOT_TOKEN`
- `OPENAI_API_KEY`
- `TELEMETRY_SALT`
- `LOG_LEVEL`
- `DEBUG_LOG_TEXT` (локально; по умолчанию 0)
- `METRICS_ENABLED`

Модельная политика фиксирована по режимам (см. `MODEL_POLICY.md`); `OPENAI_MODEL` в runtime не используется.

## Профиль бота (BotFather)
- Готовые тексты для `name/about/description` см. в `COPY.md` (раздел `15) BotFather`).
- Командное меню (`/start`, `/help`, `/friends`, `/settings`, `/demo`, `/privacy`, `/reset`, `/forget`) настраивается автоматически при старте.

## Запуск (dev)
1) Установить зависимости: `npm install`
2) Создать `.env` (ориентир — `.env.example`)
3) Запустить: `npm run dev`

## Скрипты
- `dev` — запуск в dev‑режиме
- `build` — сборка TypeScript
- `start` — запуск собранной версии
- `test` — unit‑тесты
- `lint` — eslint

## Telegram‑лимит
- Ограничение: 4096 символов.
- Целевой безопасный лимит: 3900.
- Если превышено — split на 2–3 сообщения, кнопки только на последнем.

## Smoke‑test checklist
1) `/start` → виден текст онбординга и кнопки друзей.
2) Выбор друга → подтверждение + ответ на сообщение.
3) Триггер «все сразу» → ожидание одного сообщения → панельный ответ → кнопки продолжения.
4) Триггер «сводка» → корректная сводка текущей сессии.
5) Сообщение без выбранного друга → сохранение pending + выбор друга → ответ по сохранённому тексту.
6) `/reset` → сброс сессии, выбранный друг сохраняется.
7) Soft‑safety → SafetyCheck + resume.
8) Hard‑safety → CrisisResponder + кнопки «Найти помощь/Я в безопасности».
9) `/forget` → показывается подтверждение, затем удаляется long‑term память.

## Деплой (MVP)
- Polling на VPS, **один инстанс**.
- systemd/pm2 для автозапуска.
- Не запускать параллельные экземпляры (getUpdates конфликтует).

## Приватность (MVP)
- В прод‑логах **нет** сырого текста.
- Ретеншн логов: 7 дней.
